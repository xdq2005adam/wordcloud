# 🚀 华为云轻量应用服务器部署指南

## 💰 价格说明

### 推荐配置

**秒杀活动（最便宜）：**
- 2核2G内存，2M带宽
- **价格：29元/年**（每日秒杀，限时抢购）

**常规价格：**
- 2核2G内存，3M带宽（云耀L实例）
- **价格：95-99元/年**

**更高配置：**
- 2核4G内存：99元/年
- 4核8G内存：338元/年

---

## 📋 第一步：购买服务器

### 1. 注册/登录华为云

1. 访问：https://www.huaweicloud.com
2. 注册账号（新用户有优惠）
3. 完成实名认证（必须）

### 2. 购买云耀L实例

1. 进入控制台 → **云耀云服务器 L实例**
2. 点击 **"立即购买"** 或查看 **"限时秒杀"**
3. 选择配置：
   - **地域**：选择离你最近的（如华北-北京四）
   - **镜像**：选择 **Ubuntu 22.04 LTS** 或 **CentOS 7.9**
   - **套餐**：
     - 秒杀：2核2G，2M带宽（29元/年）
     - 常规：2核2G，3M带宽（95-99元/年）
   - **购买时长**：选择1年
4. 设置密码（或使用SSH密钥）
5. 完成支付

### 3. 获取服务器信息

购买完成后，在控制台可以看到：
- **公网IP**：例如 `121.xxx.xxx.xxx`
- **系统**：Ubuntu/CentOS
- **用户名**：`root`

---

## 🔧 第二步：连接服务器

### Windows 用户

**使用 PowerShell：**

```powershell
ssh root@你的服务器IP
# 例如：ssh root@121.xxx.xxx.xxx
```

**或使用 PuTTY：**
- 下载：https://www.putty.org/
- 输入IP和端口22连接

### Mac/Linux 用户

```bash
ssh root@你的服务器IP
```

---

## 📦 第三步：安装环境

### 安装 Node.js

#### Ubuntu 系统

```bash
# 更新系统
apt update && apt upgrade -y

# 安装 Node.js 18.x
curl -fsSL https://deb.nodesource.com/setup_18.x | bash -
apt install -y nodejs

# 验证
node -v  # 应该显示 v18.x.x
npm -v
```

#### CentOS 系统

```bash
# 更新系统
yum update -y

# 安装 Node.js 18.x
curl -fsSL https://rpm.nodesource.com/setup_18.x | bash -
yum install -y nodejs

# 验证
node -v
npm -v
```

### 安装 PM2

```bash
npm install -g pm2
pm2 -v
```

---

## 📤 第四步：上传项目

### 方法一：使用 Git（推荐）

```bash
# 安装 Git
apt install git -y  # Ubuntu
# 或
yum install git -y  # CentOS

# 创建项目目录
mkdir -p /opt/wordcloud
cd /opt/wordcloud

# 克隆项目
git clone https://github.com/你的用户名/你的仓库名.git .
```

### 方法二：使用 SCP

**Windows PowerShell：**

```powershell
# 在项目目录下执行
scp -r * root@你的服务器IP:/opt/wordcloud/
```

**Mac/Linux：**

```bash
scp -r * root@你的服务器IP:/opt/wordcloud/
```

### 方法三：使用 FTP 工具

- Windows：FileZilla、WinSCP
- Mac：FileZilla、Cyberduck

---

## 🔨 第五步：安装依赖

```bash
cd /opt/wordcloud
npm install
```

**如果安装慢，可以使用国内镜像：**

```bash
npm config set registry https://registry.npmmirror.com
npm install
```

---

## 🔥 第六步：配置防火墙

### 在华为云控制台配置

1. 登录华为云控制台
2. 进入 **云耀云服务器** → 选择你的服务器
3. 点击 **安全组** 标签
4. 点击 **配置规则**
5. 点击 **添加规则**
6. 添加规则：
   - **方向**：入方向
   - **协议**：TCP
   - **端口**：3000
   - **源地址**：0.0.0.0/0（允许所有IP）
   - **描述**：词云服务端口
7. 点击 **确定**

### 或使用命令行（Ubuntu）

```bash
ufw allow 3000/tcp
ufw reload
```

---

## 🚀 第七步：启动服务

```bash
cd /opt/wordcloud

# 启动服务
pm2 start server.js --name wordcloud

# 查看状态
pm2 status

# 查看日志
pm2 logs wordcloud
```

---

## 🔄 第八步：设置开机自启

```bash
# 保存进程列表
pm2 save

# 设置开机自启
pm2 startup

# 执行上面命令输出的命令（通常是 sudo 开头的）
# 例如：sudo env PATH=$PATH:/usr/bin pm2 startup systemd -u root --hp /root
```

---

## ✅ 第九步：测试访问

打开浏览器访问：
- **主页面**：`http://你的服务器IP:3000`
- **输入页面**：`http://你的服务器IP:3000/input.html`

例如：`http://121.xxx.xxx.xxx:3000`

---

## 🔄 常用管理命令

```bash
# 查看服务状态
pm2 status

# 查看日志
pm2 logs wordcloud

# 重启服务
pm2 restart wordcloud

# 停止服务
pm2 stop wordcloud

# 更新代码后重启
cd /opt/wordcloud
git pull  # 如果使用 Git
pm2 restart wordcloud
```

---

## 🌐 配置域名（可选）

### 前置要求

1. **域名备案**（必须）
   - 华为云控制台 → 备案 → 开始备案
   - 备案时间：约 7-20 个工作日

2. **域名解析**
   - 域名管理 → 添加解析记录
   - 记录类型：A
   - 主机记录：`@` 或 `www`
   - 记录值：你的服务器公网IP

### 使用 Nginx 反向代理

```bash
# 安装 Nginx
apt install nginx -y  # Ubuntu
# 或
yum install nginx -y  # CentOS

# 编辑配置（Ubuntu）
nano /etc/nginx/sites-available/default

# 编辑配置（CentOS）
nano /etc/nginx/nginx.conf
```

**添加配置：**

```nginx
server {
    listen 80;
    server_name 你的域名.com;

    location / {
        proxy_pass http://localhost:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }
}
```

```bash
# 重启 Nginx
systemctl restart nginx
systemctl enable nginx
```

---

## 📝 常见问题

### ❌ npm install 失败

```bash
# 使用国内镜像
npm config set registry https://registry.npmmirror.com
npm install
```

### ❌ 无法访问

**检查清单：**
- [ ] 安全组是否开放 3000 端口
- [ ] 服务是否运行：`pm2 status`
- [ ] 查看日志：`pm2 logs wordcloud`
- [ ] 检查防火墙：`ufw status`

### ❌ PM2 无法开机自启

```bash
# 重新生成启动脚本
pm2 startup
pm2 save
```

### ❌ 秒杀抢不到

**解决方法：**
- 每天关注华为云限时秒杀活动
- 可以先用常规价格购买（95-99元/年）
- 后续关注活动，可以升级配置

---

## 💡 华为云特色功能

### 1. 云备份

- 控制台 → 云备份
- 可以自动备份系统和数据

### 2. 监控告警

- 控制台 → 监控
- 设置CPU、内存、带宽告警

### 3. 弹性IP

- 可以绑定弹性IP，更换服务器时保留IP

---

## 🎉 完成！

现在你的词云项目已经部署到华为云了！

**访问地址：**
- `http://你的服务器IP:3000`

**费用：**
- 秒杀价：**29元/年**（需要抢购）
- 常规价：**95-99元/年**

---

## 💰 价格优势

华为云的优势：
- ✅ **秒杀价格最低**：29元/年
- ✅ **续费价格稳定**：不像阿里云续费大幅涨价
- ✅ **性价比高**：95-99元/年配置不错

**购买建议：**
- 如果能抢到秒杀：**29元/年**（最划算）
- 如果抢不到：**95-99元/年**（也不错）

---

**需要帮助？**
- 查看日志：`pm2 logs wordcloud`
- 查看状态：`pm2 status`
- 华为云工单：控制台 → 工单中心

